# SPDX-FileCopyrightText: : 2017-2024 The PyPSA-Eur Authors
#
# SPDX-License-Identifier: CC0-1.0

tutorial: false

run:
  name: "test" # use this to keep track of runs with different settings
  disable_progressbar: true
  shared_resources:
    policy: false
  shared_cutouts: true

scenario:
  ll:
  - lv1.25
  clusters:
  - 38
  opts: 
  - Co2L-24h

countries: ['AL', 'AT', 'BA', 'BE', 'BG', 'CH', 'CZ', 'DE', 'DK', 'EE', 'ES', 'FI', 'FR', 'GB', 'GR', 'HR', 'HU', 'IE', 'IT', 'LT', 'LU', 'LV', 'ME', 'MK', 'NL', 'NO', 'PL', 'PT', 'RO', 'RS', 'SE', 'SI', 'SK']

snapshots:
  start: "2020-01-01"
  end: "2020-01-08"

enable:
  retrieve: auto
  retrieve_databundle: false
  retrieve_cost_data: false
  build_cutout: false
  custom_busmap: false
  build_renewable_profiles: true
  # retrieve_cutout: true
  # custom_busmap: false
  drop_leap_day: true

electricity:
  # BAU_mincapacities:
  #   solar: 0
  #   solar-hsat: 0
  #   onwind: 100000
  #   offwind-ac: 0
  #   offwind-dc: 100000
  #   offwind-float: 100000

  voltages: [200., 220., 300., 380., 400., 500., 750.]
  base_network: osm-prebuilt
  osm-prebuilt-version: 0.4
  gaslimit_enable: false
  gaslimit: false
  co2limit_enable: false
  co2limit: 7.75e+7
  co2base: 1.487e+9

  operational_reserve:
    activate: false
    epsilon_load: 0.02
    epsilon_vres: 0.02
    contingency: 4000

  max_hours:
    battery: 6
    H2: 168

  extendable_carriers:
    Generator: [solar, solar-hsat, offsolar, onwind, offwind-ac, offwind-float, wave-farshore, wave-nearshore, wave-shallow ] # [solar, solar-hsat, offsolar, onwind, offwind-ac, offwind-fl, wave-farshore, wave-nearshore, wave-shallow ]
    StorageUnit: [battery, H2] # battery, H2
    Store: []
    Link: [H2 pipeline] # H2 pipeline

  powerplants_filter: (DateOut >= 2023 or DateOut != DateOut) and not (Country == 'Germany' and Fueltype == 'Nuclear')
  custom_powerplants: false
  everywhere_powerplants: []

  conventional_carriers: []
  renewable_carriers: [solar, solar-hsat, offsolar, onwind, offwind-ac, offwind-float, wave-farshore, wave-nearshore, wave-shallow]  # [solar, solar-hsat, offsolar, onwind, offwind-ac, offwind-fl, wave-farshore, wave-nearshore, wave-shallow ]

  estimate_renewable_capacities:
    enable: true
    from_opsd: true
    year: 2022
    expansion_limit: false
    technology_mapping:
      Offshore: [offsolar, offwind-ac, offwind-float, wave-farshore, wave-nearshore, wave-shallow]
    #   Onshore: [onwind]
    #   PV: [solar, solar-hsat]

  autarky:
    enable: false
    by_country: false


atlite:
  default_cutout: era5_2020_cutout
  nprocesses: 4
  cutouts:
    era5_2020_cutout:
      module: era5
      x: [-12., 42.]
      y: [32., 73]
      time: ["2020-01-01", "2021-01-01"]
    # mrel_2020_cutout:
    #   module: cerra
    #   x: [-12., 42.]
    #   y: [32., 73]
    #   time: ["2020-01-01", "2021-01-01"]
    # cerra_2020_cutout:
    #   module: mrel_wave      
    #   x: [-12., 42.]
    #   y: [32., 73]
    #   time: ["2020-01-01", "2021-01-01"]


renewable:
  onwind:
    cutout: era5_2020_cutout
    resource:
      method: wind
      turbine: Vestas_V112_3MW
      smooth: false
      add_cutout_windspeed: true
    capacity_per_sqkm: 3
    # correction_factor: 0.93
    corine:
      grid_codes: [12, 13, 14, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 31, 32]
      distance: 5000
      distance_grid_codes: [1, 2, 3, 4, 5, 6, 15, 16, 17, 33, 34, 35, 38, 42, 43]
    luisa: false
      # grid_codes: [1111, 1121, 1122, 1123, 1130, 1210, 1221, 1222, 1230, 1241, 1242]
      # distance: 1000
      # distance_grid_codes: [1111, 1121, 1122, 1123, 1130, 1210, 1221, 1222, 1230, 1241, 1242]
    natura: true
    excluder_resolution: 100
    clip_p_max_pu: 1.e-2
  offwind-ac:
    cutout: era5_2020_cutout
    resource:
      method: wind
      turbine: NREL_ReferenceTurbine_2020ATB_12MW_offshore
      smooth: false
      add_cutout_windspeed: true
    capacity_per_sqkm: 7
    correction_factor: 0.8855
    corine: [44, 255]
    luisa: false # [0, 5230]
    natura: true
    ship_threshold: 400
    max_depth: 60
    min_depth: 5
    max_shore_distance: 10000 # 10 Km
    min_shore_distance: 3000 # 3 Km
    excluder_resolution: 200
    clip_p_max_pu: 1.e-2
    landfall_length: 10
  offwind-float: #Floating offshore wind dc
    cutout: era5_2020_cutout #cerra_2020_cutout
    resource:
      method: wind
      turbine: NREL_ReferenceTurbine_2020ATB_15MW_offshore
      smooth: false
      add_cutout_windspeed: true
    capacity_per_sqkm: 9
    correction_factor: 0.8855
    corine: [44, 255]
    natura: true # area excluded if true
    ship_threshold: 400
    max_depth: 250
    min_depth: 60
    max_shore_distance: 50000 # 50 Km
    min_shore_distance: 10000 # 40 Km
    excluder_resolution: 200
    potential: simple # or conservative
    clip_p_max_pu: 1.e-2
    landfall_length: 10
  solar:
    cutout: era5_2020_cutout
    resource:
      method: pv
      panel: CSi
      orientation:
        slope: 35.
        azimuth: 180.
    capacity_per_sqkm: 1
    # correction_factor: 0.854337
    corine:
      grid_codes: [12, 13, 14, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 31, 32]
      distance: 3000
      distance_grid_codes: [1, 2, 3, 4, 5, 6, 15, 16, 17, 33, 34, 35, 38, 42, 43]
    luisa: false # [1111, 1121, 1122, 1123, 1130, 1210, 1221, 1222, 1230, 1241, 1242, 1310, 1320, 1330, 1410, 1421, 1422, 2110, 2120, 2130, 2210, 2220, 2230, 2310, 2410, 2420, 3210, 3320, 3330]
    natura: true
    excluder_resolution: 100
    clip_p_max_pu: 1.e-2
  solar-hsat:
    cutout: era5_2020_cutout
    resource:
      method: pv
      panel: CSi
      orientation:
        slope: 35.
        azimuth: 180.
      tracking: horizontal
    capacity_per_sqkm: 0.85 # 15% higher land usage acc. to NREL
    corine:
      grid_codes: [12, 13, 14, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 31, 32]
      distance: 1000
      distance_grid_codes: [1, 2, 3, 4, 5, 6, 15, 16, 17, 33, 34, 35, 38, 42, 43]
    luisa: false # [1111, 1121, 1122, 1123, 1130, 1210, 1221, 1222, 1230, 1241, 1242, 1310, 1320, 1330, 1410, 1421, 1422, 2110, 2120, 2130, 2210, 2220, 2230, 2310, 2410, 2420, 3210, 3320, 3330]
    natura: true
    excluder_resolution: 100
    clip_p_max_pu: 1.e-2
  offsolar:
    cutout: era5_2020_cutout
    resource:
      method: pv
      panel: CSi
      orientation:
        slope: 35.
        azimuth: 180.
    capacity_per_sqkm: 1.7
    # correction_factor: 0.854337
    corine: [44, 255]
    natura: true
    ship_threshold: 400
    max_depth: 150
    min_depth: 0
    excluder_resolution: 200
    clip_p_max_pu: 1.e-2
  hydro:
    cutout: era5_2020_cutout
    carriers: [ror, PHS, hydro]
    PHS_max_hours: 6
    hydro_max_hours: "energy_capacity_totals_by_country" # one of energy_capacity_totals_by_country, estimate_by_large_installations or a float
    flatten_dispatch: false
    flatten_dispatch_buffer: 0.2
    clip_min_inflow: 1.0
    eia_norm_year: false
    eia_correct_by_capacity: false
    eia_approximate_missing: false
  wave-farshore:
    cutout: era5_2020_cutout #mrel_2020.cutout
    resource:
      method: wave
      wec_type: Farshore_750kW
    capacity_per_sqkm: 50 #for the packing density the safe assumption is 10-20 MW/Km2, but with good assessment this is 20-50 MW/Km2
    correction_factor: 1
    corine: [44, 255]
    luisa: false # [0, 5230]
    natura: false # area excluded if true
    max_depth: 250
    min_depth: 80
    max_shore_distance: 100000 # 100 Km
#    min_shore_distance: 40000 # 40 Km
    excluder_resolution: 200
    # potential: simple # or conservative
    clip_p_max_pu: 1.e-2
  wave-nearshore:
    cutout: era5_2020_cutout
    resource:
      method: wave
      wec_type: Nearshore_400kW
    capacity_per_sqkm: 35 #for the packing density the safe assumption is 10-20 MW/Km2, but with good assessment this is 20-40 MW/Km2
    correction_factor: 1
    corine: [44, 255]
    luisa: false # [0, 5230]
    natura: false # area excluded if true
    max_depth: 100
    min_depth: 20
    max_shore_distance: 100000 # 100 Km
    min_shore_distance: 10000 # 40 Km
    # potential: simple # or conservative
    clip_p_max_pu: 1.e-2
  wave-shallow:
    cutout: era5_2020_cutout
    resource:
      method: wave
      wec_type: Shallow_290kW
    capacity_per_sqkm: 30 #for the packing density the safe assumption is 10-20 MW/Km2, but with good assessment this is 20-40 MW/Km2
    correction_factor: 1
    corine: [44, 255]
    luisa: false # [0, 5230]
    natura: false # area excluded if true
    max_depth: 20
    min_depth: 5
    max_shore_distance: 100000 # 100 Km
    # potential: simple # or conservative
    clip_p_max_pu: 1.e-2


clustering:
  focus_weights: false
  simplify_network:
    to_substations: false
    algorithm: kmeans # choose from: [hac, kmeans]
    feature: solar+onwind-time
    exclude_carriers: []
    remove_stubs: true
    remove_stubs_across_borders: true
  cluster_network:
    algorithm: kmeans
    feature: solar+onwind-time
    exclude_carriers: []
    consider_efficiency_classes: false
  aggregation_strategies:
    generators:
      committable: any
      ramp_limit_up: max
      ramp_limit_down: max
  temporal:
    resolution_elec: false
    resolution_sector: false

lines:
  types:
    200.: "Al/St 240/40 2-bundle 200.0"
    220.: "Al/St 240/40 2-bundle 220.0"
    300.: "Al/St 240/40 3-bundle 300.0"
    380.: "Al/St 240/40 4-bundle 380.0"
    400.: "Al/St 240/40 4-bundle 380.0"
    500.: "Al/St 240/40 4-bundle 380.0"
    750.: "Al/St 560/50 4-bundle 750.0"
  s_max_pu: 0.7
  s_nom_max: .inf
  max_extension: 20000 #MW
  length_factor: 1
  reconnect_crimea: true
  under_construction: 'keep' # 'zero': set capacity to zero, 'remove': remove, 'keep': with full capacity for lines in grid extract
  dynamic_line_rating:
    activate: false
    cutout: era5_2020_cutout
    correction_factor: 0.95
    max_voltage_difference: false
    max_line_rating: false

load:
  interpolate_limit: 3
  time_shift_for_large_gaps: 1w
  manual_adjustments: true # false
  scaling_factor: 1.5
  fixed_year: false # false or year (e.g. 2013)
  supplement_synthetic: true
  distribution_key:
    gdp: 0.6
    population: 0.4

# docs in https://pypsa-eur.readthedocs.io/en/latest/configuration.html#transmission_projects
transmission_projects:
  enable: false
  include:
    tyndp2020: false
    nep: false
    manual: false
  skip:
  - upgraded_lines
  - upgraded_links
  status:
  - under_construction
  - in_permitting
  - confirmed
    #- planned_not_yet_permitted
    #- under_consideration
  new_link_capacity: zero #keep or zero

costs:
  year: 2030
  version: v0.9.2
  social_discountrate: 0.02
  fill_values:
    FOM: 0
    VOM: 0.01
    efficiency: 1
    fuel: 0
    investment: 0
    lifetime: 25
    "CO2 intensity": 0
    "discount rate": 0.07
  # Marginal and capital costs can be overwritten
  # capital_cost:
  #   onwind: 500
  marginal_cost: #VOM
    solar: 0.01
    solar-hsat: 0.01
    onwind: 0.02
    offwind-ac: 0.02
    offwind-float: 0.02
    wave-farshore: 0.02
    wave-nearshore: 0.02
    wave-shallow: 0.02
    offwind: 1000
    # hydro: 0.
    # H2: 0.
    # electrolysis: 0.
    # fuel cell: 0.
    # battery: 0.
    # battery inverter: 0.
  emission_prices:
    enable: false
    co2: 0.
    co2_monthly_prices: false

solving:
  constraints:
    BAU: false
    EQ: false
  solver:
    name: gurobi
    options: gurobi-default

plotting:
  map:
    boundaries: [-11, 30, 34, 71]
    color_geomap:
      ocean: lightblue
      land: white
  projection:
    name: "EqualEarth"
    # See https://scitools.org.uk/cartopy/docs/latest/reference/projections.html for alternatives, for example:
    # name: "LambertConformal"
    # central_longitude: 10.
    # central_latitude: 50.
    # standard_parallels: [35, 65]
  eu_node_location:
    x: -5.5
    y: 46.
  costs_max: 1000
  costs_threshold: 1
  energy_max: 20000
  energy_min: -20000
  energy_threshold: 50.

  nice_names:

    onwind: "Onshore Wind"
    offwind-ac: "BF Offshore Wind"
    offwind-dc: "Offshore Wind (DC)"
    offwind-float: "FL Offshore Wind"
    wave-farshore: "WEC Farshore"
    wave-nearshore: "WEC Nearshore"
    wave-shallow: "WEC Shallow"
    solar: "Solar"
    solar-hsat: "Solar-HSAT"
    offsolar: "FL Solar"
    PHS: "Pumped Hydro Storage"
    hydro: "Reservoir & Dam"
    battery: "Battery Storage"
    H2: "Hydrogen Storage"
    lines: "Transmission Lines"
    ror: "Run of River"
    load: "Load Shedding"
    ac: "AC"
    dc: "DC"

  tech_colors:
    # wind
    onwind: "#2D61A6"
    onshore wind: "#2D61A6"
    offwind: "#6895dd"
    offshore wind: "#29A2CC"
    offwind-ac: "#29A2CC"
    offshore wind (AC): "#29A2CC"
    offshore wind ac: "#29A2CC"
    offwind-dc: "#29A2CC"
    offshore wind (DC): "#29A2CC"
    offshore wind dc: "#29A2CC"
    offwind-float: "#52DAE5"
    offshore wind (Float): "#52DAE5"
    offshore wind float: "#52DAE5"
    # water
    hydro: '#FC6D8E'
    hydro reservoir: '#FC6D8E'
    ror: '#F2BDE4'
    run of river: '#F2BDE4'
    hydroelectricity: '#298c81'
    PHS: '#CF1F33'
    hydro+PHS: "#08ad97"
    # solar
    solar: "#F2CE1B"
    solar PV: "#f9d002"
    solar-hsat: "#F2A30F"
    solar thermal: '#ffbf2b'
    offsolar: '#F2620F'
    residential rural solar thermal: '#f1c069'
    services rural solar thermal: '#eabf61'
    residential urban decentral solar thermal: '#e5bc5a'
    services urban decentral solar thermal: '#dfb953'
    urban central solar thermal: '#d7b24c'
    solar rooftop: '#ffea80'
    # wave
    wave-farshore: '#4CE766'
    wave-nearshore: '#24961A'             
    wave-shallow: '#216406'
    # power transmission
    lines: '#6c9459'
    transmission lines: '#6c9459'
    electricity distribution grid: '#97ad8c'
    low voltage: '#97ad8c'
    # electricity demand
    Electric load: '#B4A7B2'
    electric demand: '#B4A7B2'
    electricity: '#B4A7B2'
    industry electricity: '#2d2a66'
    industry new electricity: '#2d2a66'
    agriculture electricity: '#494778'
    # battery + EVs
    battery: '#ace37f'
    battery storage: '#ace37f'
    battery charger: '#F2762E'
    battery discharger: '#5B224E'
    home battery: '#80c944'
    home battery storage: '#80c944'
    home battery charger: '#F2762E'
    home battery discharger: '#5B224E'
    BEV charger: '#baf238'
    V2G: '#e5ffa8'
    land transport EV: '#baf238'
    land transport demand: '#38baf2'
    EV battery: '#baf238'
    # hydrogen
    H2 for industry: "#f073da"
    H2 for shipping: "#ebaee0"
    H2: '#bf13a0'
    hydrogen: '#bf13a0'
    retrofitted H2 boiler: '#e5a0d9'
    SMR: '#870c71'
    SMR CC: '#4f1745'
    H2 liquefaction: '#d647bd'
    hydrogen storage: '#bf13a0'
    H2 Store: '#bf13a0'
    H2 storage: '#bf13a0'
    land transport fuel cell: '#6b3161'
    H2 pipeline: '#f081dc'
    H2 pipeline retrofitted: '#ba99b5'
    H2 Fuel Cell: '#D0D98B'
    H2 fuel cell: '#D0D98B'
    H2 turbine: '#991f83'
    H2 Electrolysis: '#36373A'
    H2 electrolysis: '#36373A'
    AC: "#70af1d"
    AC-AC: "#70af1d"
    AC line: "#70af1d"
    links: "#8a1caf"
    HVDC links: "#8a1caf"
    DC: "#8a1caf"
    DC-DC: "#8a1caf"
    DC link: "#8a1caf"
    load: "#B4A7B2"
    waste CHP: '#e3d37d'
    waste CHP CC: '#e3d3ff'
    HVC to air: 'k'

